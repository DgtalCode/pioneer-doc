Обновление прошивки автопилота
==============================

Для корректной работы всех систем Пионера Мини необходимо устанавливать последнюю актуальную версию прошивки. Процедура обновления и настройки происходит с помощью программы  Pioneer Station. 
Скачать актуальную версию программы можно из раздела `Pioneer Station`_. 

.. important:: Перед осуществлением первого полета, обязательно обновите прошивку и параметры автопилота "Пионера Мини". Полет с устаревшей версией прошивки автопилота ниже чем |utd_ap_mini| может быть небезопасен.

Инструкция по обновлению прошивки автопилота "Пионера Мини"
-----------------------------------------------------------

1. Cкачайте актуальную версию прошивки |fw_ap_mini|. Тестовые и ранние версии находятся в разделе :doc:`../../../downloads/software-d`.

2. Подключите квадрокоптер к компьютеру с помощью кабеля micro-USB и включите квадрокоптер нажав на кнопку сбоку. Левый светодиод сзади должен начать мигать.

  .. figure:: media/power_on_usb.svg
    :width: 600px

3. Запустите программу "Pioneer Station". В левом нижнем углу нажмите кнопку **"Подключение"** и выберете **"По кабелю USB"**

  .. figure:: ../../../_static/images/firmware_upd_all/fw_upd_step1.PNG

  .. note:: Если по истечении 10 секунд окно программы не обновилось, попробуйте переподключить квадрокоптер и перезапустить программу. Если это не помогло, попробуйте `скачать и установить драйвер порта`_, после чего переподключите "Пионер Мини" и перезапустите программу.

4. В верхнем правом углу нажмите иконку **"квадрокоптера"** и выберете **"Обновление прошивки"**

  .. figure:: ../../../_static/images/firmware_upd_all/fw_upd_step2.PNG

5. В открывшемся окне нажмите **"Далее"**. Коптер перейдёт в в режим **загрузчика**. Обратите внимание, как поменялась цветовая индикация на Пионере. В следующем окне нажмите **"Обновить"** и выберете модуль **"DFUPioneer-Mini-A"** это и есть базовая плата "Пионера Мини".

  .. container:: flexrow

    .. figure:: ../../../_static/images/firmware_upd_all/fw_upd_step3.PNG

    .. figure:: ../../../_static/images/firmware_upd_all/fw_upd_mini_step4.PNG

  .. note:: Если при выборе устройства квадрокоптер не отображается в окне, нажмите кнопку "Обновить" еще раз.

6. В следующем окне нажмите **"Из файла"** и укажите путь к ранее скачанному файлу **pioneer_mini_V1_1-boot-pioneer-1.6.92xx.bin** 

  .. attention:: Обратите внимание версия прошивки должна быть |utd_ap_mini| или старше а также соответствовать версии загрузчика. Определить версию загрузчика поможет цветовая индикация. Если на данном шаге (после перехода в режим загрузчика) горит только правый зелённый светодиод - необходимо выбрать версию с подписью **bootloader_v1**. Если кроме зелёного светодиода горит красный - выберите версию с подписью **bootloader_v2**. 

  .. figure:: ../../../_static/images/firmware_upd_all/fw_upd_mini_step5.PNG

7. Нажмите **Прошить**. Обновление может занимать до нескольких минут в зависимости от вашего ПК.

  .. attention:: Не прерывайте соединение USB между коптером и ПК во время обновления, это может привести к серьезным проблемам и временному выходу квадрокоптера из строя!

8. Дождитесь окончания прошивки, это может занять несколько минут. После завершения нажмите "ОК", после чего отключите питание и затем заново включите квадрокоптер нажатием на кнопку на корпусе. Левый задний светодиод должен периодически мигать фиолетовым (или желтым) цветом.

9. Заново подключитесь к квадрокоптеру в стандартном режиме по USB и проверьте версию АП. Если прошивка прошла успешно в столбце *"Версия"* вы увидите значение не меньше чем |utd_ap_mini|. Если в графе "Отказы" осталась ошибка *RESTART_REQUIRED* - повторите перезагрузку. 

  .. figure:: ../../../_static/images/firmware_upd_all/fw_upd_mini_step6.PNG

10. После обновления прошивки автопилота, вам необходимо обновить параметры автопилота. Вы можете сделать это автоматически при обновлении второго контроллера ESP-32, либо вручную на странице :doc:`autopilot_parameters`. 

.. tip:: Отказ *UNPROTECTED* не влияет на полет, это служебное уведомление для разработчиков. На пользовательский опыт это никак не влияет. Отказ *RESTART_REQUIRED* пропадает через 2 перезагрузки, если этого не проиходит - напишите в техническую поддержку.

.. note:: Если у вас возникла ошибка "Ошибка подключения к НСУ", вы можете исправить ее через обновление параметров с помощью ESPTOOL либо воспользоваться утилитой minipatcher:
          :doc:`../../../mini-nsu`

.. tip:: Если у вас возникли вопросы по изменению тех или иных параметров, вы всегда можете обратиться в техподдержку написав на почту support@geoscan.aero или в `telegram-канал <https://t.me/geoscan_edu>`_.




.. _Более подробно про режим загрузчика: //mini_first-power-on.html
.. _Pioneer Station: ../../../programming/pioneer_station/pioneer_station_main.html
.. _Pioneer Station: ../../../programming/pioneer_station/pioneer_station_main.html
.. _скачать и установить драйвер порта: https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers