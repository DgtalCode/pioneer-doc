Настройка параметров автопилота
===============================

Параметры полета квадрокоптера в ручном и автоматическом режиме можно тонко настроить, используя программу :doc:`../../../programming/pioneer_station/pioneer_station_main`. Для настройки "Пионера" должен быть подключен к компьютеру. Для перехода к настройке откройте вкладку "Параметры автопилота", текущие параметры должны отображаться в правой части окна.

.. note:: Настоятельно рекомендуем обновить параметры вашего "Пионера". Параметры автопилота "Пионер Мини" и базового "Пионера" различаются имейте это в виду. Это связано с различной электронной начинкой квадрокоптеров.

.. attention:: Перед загрузкой параметров, обязательно обновите прошивку автопилота, это очень важно! Как это сделать вы можете просмотреть в разделе
               :doc:`firmware_upgrade`.

.. contents::
	:local:
	:backlinks: none 


Загрузка параметров на Базовый Пионер
-------------------------------------

1. Скачайте `Параметры АП для Pioneer Base <https://disk.yandex.ru/d/Doq-oA6ZwtM9Tw>`__ в удобную для вас папку. В большинстве случаев, рекомендуемые параметры находятся в архиве с прошивкой и имеют расширение **.properties**. 

2. Подключитесь к Пионеру с помощью Pioneer Station. Нажмите кнопку **"Открыть из файла"** |upload|

3. В диалоговом окне укажите путь к папке с параметрами, после чего выберите необходимый файл с расширением **.properties** и нажмите **"Открыть"**.

4. В открывшемся окне, вы увидите отличающиеся значения. Изображение снизу является примером. В колонке "Автопилот" отображаются текущие параметры, в столбце "Файл" находятся новые значения параметров которые будут изменены. Нажмите кнопку "ОК".

5. Для загрузки новых параметров нажмите кнопку **"Cохранить изменения на автопилот"** |push| и дождитесь окончания перезагрузки.

.. image:: /_static/images/autopilot.PNG

В верхнем меню Pioneer Station присутствуют кнопки |btnLPS| и |btnOPT|. Каждая из них загружает в квадрокоптер стандартный набор параметров для полета, соответственно, в локальной системе позиционирования и полёта с помощью модуля оптического позиционирования.

Изменение текущих параметров
----------------------------

Перейдите во вкладку **"Параметры автопилота"**. В первом столбце таблицы приведены названия параметров. Назначение каждого из них описано в крайнем правом столбце **"Описание"**. Во втором столбце отображаются текущие значения параметров автопилота.

.. figure:: ../../../_static/images/prop_upd_all/param_1.PNG

Если вы хотите поменять какое-либо из них, введите новое значение в столбец **"Новое значение"** и нажмите Enter. Завершив редактирование, не забудьте сохранить изменения, нажав кнопку **"Cохранить изменения на автопилот"** |push|

Также вы имеете возможность открыть полный список параметров автопилота отметив чекбокс **"Все параметры"**

.. danger:: Самостоятельное изменение некоторых параметров может непреднамеренно привести к фатальным ошибкам работы автопилота. Если вы не знаете что это за параметры, лучше их не изменять.

.. note:: Если вы хотите вернуться к заводским настройкам, нажмите кнопку **сбросить по умолчанию** над таблицей и подождите пока "Пионер" перезапустится.

________

Настройка режима "Возврат домой"
--------------------------------

В Пионере предусмотрен режим возврата домой (RTL) в экстренных ситуациях. Домашней точкой считается место, где был произведён запуск двигателей. Квадрокоптер перейдёт в режим возврата в следующих случаях:

* При низком заряде на аккумуляторе
* При отсутствии сигнала от системы навигации
* При отсутствии сигнала c пульта радиоуправления

В автопилоте режим RTL настраивается с помощью следующих параметров:

* **Flight_com_navSystem** - параметр указывает какую систему навигации следует использовать при полёте. При значении 0 – используется GNSS (спутниковая система навигации). При значении 1 – локальная система (в случае использовании модуля ИК-навигации или системы Геоскан Локус). При значении 2 – квадрокоптер будет использовать модуль оптического позиционирования.
* **Flight_com_rtlVoltage** - параметр устанавливает напряжение в V ниже которого включается возврат домой. Для отключения возврата по напряжению параметр необходимо установить в 0. Событие о низком напряжении генерируется в течении полёта однократно.
* **Flight_com_landingVol** - параметр задаёт напряжение ниже которого производится экстренная посадка. Стоит учитывать, что посадка будет произведена, прервав возврат домой, где бы ни находился квадрокоптер, если напряжение опустится ниже указанного.
* **Flight_com_autoFlightT** - параметр задаёт длительность автоматического полёта. Полёт считается автоматическим в случае пропадания связи с пультом радиоуправления.  
* **Copter_flyWithoutRc** - параметр позволяющий запускать квадрокоптер автономно без пульта радиоуправления. Автопилот не начнёт выполнять скрипт в случае, если пульт ДУ не связан с приёмником или выключен (значение 1) или проигнорирует его отсутствие (значение 0).
* **Flight_com_landAtHome** - включение посадки при возврате домой. Данный параметр определяет, надо ли садиться при достижении точки дома в режиме возврата (значение 1) или нужно зависнуть над точкой дома (значение 0).
* **Flight_com_homeAlt** - высота над точкой дома в метрах, использующаяся в режиме возврата домой. Коптер зависнет на этой высоте над точкой дома.
* **Flight_com_rtlAltMode** - параметр определяющий режим возврата домой. Квадрокоптер долетит до точки дома с удержанием высоты, после чего совершит посадку (значение 0), либо будет постепенно снижаться при возврате (значение 1).
* **Flight_com_returnAlt** - высота возврата в домашнюю точку.

________

Настройка параметров при замене на не заводские моторы
------------------------------------------------------

Если вы заменили двигатели на Пионере, они могут отличаться по электрическим характеристикам и не пройдут предстартовые проверки при подготовке к взлёту. За неё отвечают параметры:

* **Copter_motorCheckTime** - время проверки скорости оборотов двигателей на старте в секундах. Для отключения проверки установите значение параметра 0 
* **Copter_startRpmMax** - максимальное количество об/мин для проверки на старте
* **Copter_startRpmMin** - минимальное количество об/мин для проверки на старте
* **Copter_startRpmSigma** - максимальное расхождение между измеренными оборотами двигателей, при превышении которого считается, что двигатели работают неравномерно.

При получении команды на взлет (первые 5 секунд) проводится ещё одна проверка:

* **Copter_stallRpm** - предельная величина оборотов, после которой считается, что произошел срыв синхронизации, и двигатели отключаются. Для нестандартных двигателей можно использовать максимально возможные холостые обороты двигателя (для этого нужно умножить kv двигателя на напряжение аккумулятора)

В случае замены двигателей на более мощные вам также может понадобиться настроить PID коэффициенты. Неправильные PID  - причина заметных вибраций и колебаний коптера в полёте. 

Чтобы настроить PID коэффициенты, используйте следующие параметры:

* **Copter_xyRate_ki** - интегральная часть регулятора. Его нужно уменьшить, если квадрокоптер нехотя отзывается на управление, и увеличить, если заметны низкочастотные колебания.
* **Copter_xyRate_kp** - пропорциональная часть регулятора. Его можно уменьшить, если присутствует заметное перерегулирование и высокочастотные колебания (коптер дрожит во время зависания в одной точке). Если квадрокоптер плохо отзывается на управление, значение параметра нужно увеличить. 

.. note:: Для оценки допустимых оборотов, запишите логи полёта в ручном режиме управления и просмотрите график **rpm** в канале данных **motor-x**. Подробнее в разделе :doc:`logs`



.. |download| image:: ../../../_static/images/PSIcon/download_param.PNG

.. |upload| image:: ../../../_static/images/PSIcon/upload_param.PNG

.. |push| image:: ../../../_static/images/PSIcon/push_param.PNG

.. |update| image:: ../../../_static/images/PSIcon/update_param.PNG

.. |btnLPS| image:: ../../../_static/images/PSIcon/btn_LPS.PNG

.. |btnOPT| image:: ../../../_static/images/PSIcon/btn_OPT.PNG