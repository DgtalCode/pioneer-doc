Управление квадрокоптером с контроллера Трик
============================================


Необходимое оборудование
------------------------

Для тестирования работы протокола Mailbox не обязательно иметь реальный контроллер Трик, так как среда разработки TrikStudio
имеет встроенный симулятор, который поддерживает передачу данных по Mailbox, поэтому, список необходимого оборудования и ПО
выглядит следующим образом:

#. `TrikStudio. <https://trikset.com/downloads#trikstudio>`__
#. `PioneerStation. <https://dl.geoscan.aero/pioneer/upload/GCS/GEOSCAN_Pioneer_Station.exe>`__
#. `Квадрокоптер Геоскан Пионер Мини. <https://www.geoscan.aero/ru/products/pioneer/mini>`__
#. `Контроллер Трик (опционально). <https://trikset.com/prices>`__



Подготовка к работе
-------------------

Для начала работы над проектом необходимо подготовить оборудование:

#. Как уже говорилось, установить две среды разработки
#. Если у вас есть контроллер Трик - `обновить прошивку контроллера. <https://help.trikset.com/trik/firmware>`__
#. Проверить версию прошивок квадрокоптера и при необходимости обновить прошивку автопилота `по инструкции. <https://docs.geoscan.aero/ru/master/instructions/pioneer-mini/settings/firmware_upgrade.html>`__ и прошивку ESP32 `по инструкции. <https://docs.geoscan.aero/ru/master/instructions/pioneer-mini/settings/esp32-update.html>`__

Скачать архив с прошивками автопилота и ESP32



Основные сведения по работе с протоколом Mailbox
------------------------------------------------

Объект Mailbox позволяет реализовать беспроводную передачу данных между несколькими устройствами, поддерживающими данный протокол.
Передача данных осуществляется по WI-FI.

При запуске программы и необходимости передать некторое сообщение от первого устройства второму, первое устройство инициирует подключение
по известному IP-дресу устройства в WI-FI сети
специальной командой (`см. описание функции connect <https://help.trikset.com/trik/programming-code/object-mailbox#connect>`__), таким
образом утройство регистрируется в сети "почтовых ящиков".

У каждого устройства в сети для стабильной работы должен быть установлен уникальный бортовой номер, с помощью которых и происходит адресация
при отправке сообщений.

При инициировании подключения между устройствами происходит обмен данными об их бортовых номерах, а также об известных им подключениях.
То есть, если взять три контроллера К1, К2 и К3, инициировать подключение К2->К1, а затем К3->К1, то при подключении К3 к К1, К1 передаст данные
об известных ему подключениях, и К3 узнает о существовании К2, поэтому, при дальнейшей необходимости отправить сообщение с К3 на К2, инициализации подключения командой mailbox.connect производить не нужно.

Стоит обратить внимание, что для удобства написания кода как на JS для Трик, так и на LUA для Пионера, команды унифицированы,
то есть все привычные команды объекта Mailbox в JavaScript имеют тот же вид и тот же функционал в Lua для Пионера.

Ознакомиться с командами объекта mailbox можно в `документации Трик. <https://help.trikset.com/trik/programming-code/object-mailbox>`__
